# Алгоритмы и структуры данных. Домашнее задание №6

## Выполнил студент Наседкин Дмитрий Сергеевич (группа 242)

## Письменная часть

### № 1

Перед тем как решать подпункты, давайте расскажем об общих соображениях:

Давайте рассмотрим любую точку, которая покрыта наибольшим кол-вом окружностей, и так как она покрыта хотя бы одной окружностью, то эту точку можно "сдвинуть" в какую-нибудь сторону до тех пор пока она достигнет границы какой-либо окружности(то есть что кол-во покрывающих не будет меняться), рассмотрим все такие точки что лежат на границе какой-то окружности и находтся в той же области что и наша точка(то есть для всех них ответ одинаковый). Дальше возможны 2 варианта:

- Все эти точки лежат на одной окружности, в этом случае и центр этой окружности покрыт таким же кол-вом точек

- Существует хотя бы одна точка среди них, что принадлежит хотя бы 2-ум окружностям, то есть это точка пересечения окружностей, которая покрыта таким же количеством точек.

Итого доказали, что точка покрытая наибольшим кол-вом окружностей это обязательно либо центр какой-то окружности, либо точка пересечения окружностей.

Окружности не пересекаются, либо пересекаются в одной точке, либо в 2-ух точках, либо одна полностью содержится в другой. Как находить точки пересечения опишем ниже, а случай вложенности проверяется тривиально.

Сразу на 2 подпункта скажем, что перед началом можно рассмотреть центры всех окружностей, их $n$, после чего для каждой явно насчитать количество окружностей, которым она принадлежит, очевидно, для одной точки это делается за $O(n)$(проверить, что расстояние от центра до нужной точки меньше либо равно радиусу окружности, и так для всех окружностей). Итого для всех центров это будет работать за $O(n^2)$, что подходит под оба пункта, поэтому осталось научится обрабатывать случай, когда наша точка - точка пересечения окружностей.

**(а)** Давайте найдем все точки пересечения окружностей, для этого для каждой окружности найдем все точки пересечения с другими, перебрав все остальные $(n - 1)$ окружностей и за $O(1)$ находя точки пересечения. Из соображений выше их будет не больше $2n = O(n)$, тогда суммарно будет $O(n^2)$ точек пересечения. Для каждой такой точки как выше можно за $O(n)$ насчитать сколькими окружностями она покрывается и найти максимум. Итого алгоритм будет работать за $O(n^3)$.

**(б)** Давайте для каждой окружности делать это процесс отдельно, а именно, найдем для окружности все точки пересечения окружностей с данной, это делается за $O(n)$. Изначальный счетчик равен 1(Так как любая точка на окружности покрыта хотя бы нашей). (Если точка пересечения с окружностью одна, то добавим все равно 2 равные точки, потом станет ясно почему, а если наша окружность вложена в какую-то, то к изначальному счетчику прибавим 1). После чего точки пересечения отсортируем по полярному углу от центра координат(для каждой точки держим ее координаты и какой окружности она принадлежит), это работает за $O(n \log n)$. Теперь наша задача свелась к поиску точки, покрытой наибольшим количеством отрезков + значения изначального счетчика, то есть будем идти по отсортированному списку, поддерживая текущее кол-во отрезков, и если встречаем эту окружность нечетный раз, то +1, иначе -1, а также поддерживая текущий максимум среди кол-ва отрезков. Единственное, осталось сказать, так как мы работаем все таки не с отрезками, а с дугами, то для первой точки списка придется за $O(n)$ явно посчитать какие окружности уже "включены" и прибавить к текущему(и учтя что мы уже их встретили). (По той же причине выше мы разделили случаи на чет, нечет).

Итого для одной окружности это работает за $O(n \log n)$, тогда для $n$ окружностей итоговое время работы будет $O(n^2 \log n)$.

P.S. Точку пересечения 2 окружностей легко найти как решение системы:

$$
\begin{cases}
    (x - x_i)^2 + (y - y_i)^2 = r^2_i \\
    (x - x_j)^2 + (y - y_j)^2 = r^2_j
\end{cases}
\sim
\begin{cases}
    (x - x_i)^2 + (y - y_i)^2 = r^2_i \\
    x(2x_j - 2x_i) + y(2y_j - 2y_i) + (x_i^2 - x_j^2 + y_i^2 - y_j^2 + r^2_j - r^2_i) = 0
\end{cases}
$$

То есть нужно найти точку пересечения прямой и окружности, а для этого нужно просто решить квадратное уравнение, то есть все и правда делается за $O(1)$.

### № 2

Введем $X_i$ как индикаторную случайную величину для $i$-ого испытания:

$$
X_i =
\begin{cases}
    1, \text{если событие произошло в i-м испытании} \\
    0, \text{если событие не произошло}
\end{cases}
$$

Тогда наша оценка вероятности по Монте-Карло:

$$
\hat p = \frac{1}{n}\sum_{i=1}^n X_i.
$$

Найдем мат. ожидание и дисперсию $\hat{p}$:

$$
\mathbb{E}(\hat p) = \mathbb{E}(\frac{1}{n}\sum_{i=1}^n X_i) = \frac{1}{n}\sum_{i=1}^n \mathbb{E}(X_i) = \frac{1}{n}\sum_{i = 1}^n Pr(X_i) = \frac{n}{n} p = p.
$$

$$
\mathbb{D}(X_i) = \mathbb{E}(X_i^2) - \mathbb{E}^2(X_i) = \mathbb{E}(X_i) - \mathbb{E}^2(X_i) = p - p^2 = p(1 - p)
$$

Так как любые 2 события независимы, то получим:

$$
\mathbb{D}(\hat p) = \mathbb{D}(\frac{1}{n}\sum_{i = 1}^n X_i) = \frac{1}{n^2}\mathbb{D}(\sum_{i=1}^n X_i) = \frac{1}{n^2}\sum_{i=1}^n\mathbb{D}(X_i) = \frac{np(1 - p)}{n^2} = \frac{p(1 - p)}{n}.
$$

Нам нужно:

$$
Pr(\frac{|\hat p - p|}{p} \le 0.002) \ge 0.99 \Leftrightarrow Pr(|\hat p - p| \le 0.002p) \ge 0.99
$$

Используя неравенство Чебышева получим:

$$
Pr(|\hat p - \mathbb{E(\hat p)}| \ge a) \le \frac{\mathbb{D(\hat p)}}{a^2},
$$
то есть
$$
Pr(|\hat p - p| \le a) \ge 1 - \frac{p(1 - p)}{na^2}
$$

Подставляя $a = 0.002p$ получим:

$$
1 - \frac{p(1 - p)}{na^2} \ge 0.99 \implies n \ge \frac{100p(1 - p)}{a^2} = \frac{10^8(1 - p)}{4p}
$$

Видим стандартную гиперболу $\frac{1}{x}$, она монотонно убывает при $x > 0$, тогда максимальное значение достигается при $p = 0.7$(так как $0.7 \le p \le 0.8$).

Отсюда $n \geq \frac{10^8 \cdot 0.3}{4 \cdot 0.7} = 10714285,714285714285714$.

Так как $n$ - натуральное, то $n \ge 10714286$. Ну или если удобнее, то $n \sim 10^7$.

## Устная и письменная часть

### № 3

Во первых, заметим, что если второй многоугольник лежит строго внутри первого, то его площадь меньше первого. Тогда свапнем их, если оказалось наоборот, то есть получили, что если вложенность возможно, то только второй может лежать внутри первого.

Второй многоугольник лежит строго внутри первого, если каждая вершина второго многоугольника лежит строго внутри первого. Помним, что стандартный метод "быстро" проверить принадлежность точки выпуклому многоугольнику, это разбить его на треугольники(триангулировать) от одной точки(возьмем самую левую, если несколько то нижнюю из них), после чего находить треугольник, в котором заключена точка, и остается проверить лежит ли она внутри данного треугольника(между двумя прямыми уже есть, останется проверить левее ли она третьей прямой). См. рисунок
![image1](/teor_algos_hm/src/hm6_img1.png)

Сделаем сдвиг точек в меньшем многоугольнике так, чтобы точка с самым маленьким $y$ оказалась первой(если несколько, то левую из них). Тогда не важно, давались ли нам точки в порядке какого обхода получим, что $y$-и сначала будут возрастать(убывать), после чего убывать(возрастать), то есть другими словами построили левую и правую огибающую. В каждой из которых точки будут монотонно возрастать по $y$ (одну из них нужно будет реверснуть). Каждую из огибающих будем обрабатывать отдельно, но тем же алгоритмом что ниже.

Вернемся к нашему старему алгоритму, заметим, что так как $y$-ики возрастают, то если мы нашли первую прямую, что выше текущей точки, то для всех последующих точек первая прямая выше их может идти только дальше, а значит можно пройтись двумя указателями, поддерживая текущую прямую с одной стороны(из большего многоугольника), а с другой текущую точку(из меньшего многоугольника). Если хоть одна точка оказалась не внутри большего многоугольника, то они не вложены. Очевидно, что время работы получится линейным.

### № 4

Как проверить, что прямая пересекает выпуклый многоугольник? Найдем 2 касательные(и их канонические уравнения прямой), параллельные данной прямой к данному многоугольнику, тогда если $C_1 \leq C \leq C_2$, то прямая пересекает многоугольник, где $C_1, C, C_2$ свободные параметры при уравнениях первой касательной, нужной прямой, второй касательной соответственно.

См. рисунок
![image2](/teor_algos_hm/src/hm6_img2.png)

Так как многоугольник выпуклый, то вектора сторон уже упорядочены по полярному углу(возможно со сдвигом, но сдвиг можно сделать за $O(n)$), тогда чтобы найти касательную параллельную направляющему вектору прямой $v = (A, B)$ нужно взять первую прямую, полярный угол которой больше угла полярного угла $v$. (Другая касательная найдется если рассмотреть $-v$).

Вернемся к нашей задаче, так как у нас прямые упорядочены по углу нормали, то они упорядочены и по углу направляющего вектора(возможно со сдвигом, но сдвиг можно сделать за $O(m)$). Пусть мы нашли за линию для первой прямой 2 касательные, и запомнили к каким точкам многоугольника они относятся. Тогда для следующей прямой(у ее направляющего вектора угол больше угла текущей), касательной могут быть только последующие по порядку полярного угла стороны(то есть следующие в порядка обхода)(И понятно, что брать нужно индексы по модулю). Таким образом поддерживая 3 указателя(2 указателя для индекса сторон касательных и один для текущей прямой в порядке угла) можем ответить на все запросы.

Осталось доказать, что время работы будет линейным, для этого заметим, что никакой из указателей для индексов касательных не сделает больше $n$ переходов, так как иначе получилось бы, что существуют 2 индекса $i < j$, такие что угол $v_i$ больше угла $v_j$, что невозможно, так как углы прямых упорядочены.
